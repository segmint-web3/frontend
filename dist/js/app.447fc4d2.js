(function(){var t={1974:function(t,e,n){"use strict";var i=n(7195),s=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[t.myNftOpened?e("MyNftComponent",{attrs:{onClose:t.closeMyNfts}}):t._e(),e("HeaderComponent",{attrs:{openMyNfts:t.openMyNfts,isEditingMode:t.isEditingMode,toggleEditingMode:t.toggleEditingMode}}),e("CanvasComponent",{attrs:{isEditingMode:t.isEditingMode}}),t.isCollectionLoaded?t._e():e("div",{staticClass:"loading-fullscreen"},[t._m(0)])],1)},o=[function(){var t=this,e=t._self._c;return e("div",[e("h1",[t._v("Loading collection")]),e("div",{staticClass:"lds-ring"},[e("div"),e("div"),e("div"),e("div")])])}],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-wrapper"},[e("div",{staticClass:"flex"},[e("img",{staticClass:"logo",attrs:{src:`${t.publicPath}icons/logo.svg`,alt:"logo"}}),e("a",{staticClass:"secondary-button mode-button",attrs:{href:"#"},on:{click:t.$props.toggleEditingMode}},[t._v(t._s(t.isEditingMode?"View mode":"Mint mode"))]),t.$store.state.Provider.account?e("a",{staticClass:"secondary-button nft-button",attrs:{href:"#"},on:{click:t.$props.openMyNfts}},[t._v("My NFT")]):t._e()]),e("div",{staticClass:"description"},[e("span",[t._v("Page "+t._s(t.epoch))]),e("div",{staticClass:"dot"}),e("span",[t._v(t._s(t.pixelPrice)+" venom per pixel")])]),t.$store.state.Provider.account?e("div",{staticClass:"flex wallet-info"},[e("div",{staticClass:"info"},[e("div",{staticClass:"address"},[t._v(t._s(t.address))]),e("div",{staticClass:"coins"},[t._v(t._s(t.balance)+" VENOM")])]),e("img",{staticClass:"exit",attrs:{src:`${t.publicPath}icons/exit.svg`,alt:"exit"},on:{click:t.disconnect}})]):e("div",{staticClass:"wallet-connect"},[e("button",{staticClass:"primary-button connect",on:{click:t.connect}},[t._v("Connect wallet")])])])},r=[],l={name:"HeaderComponent",data(){return{publicPath:"/"}},props:["openMyNfts","isEditingMode","toggleEditingMode"],computed:{address(){let t=this.$store.state.Provider.account._address;return t.slice(0,7)+"..."+t.slice(-4)},balance(){return this.$store.state.Provider.venomBalance},epoch(){return this.$store.state.Provider.epoch},pixelPrice(){let t=parseInt(this.$store.state.Provider.currentTilePrice)/1e11;return t.toString()}},methods:{connect(){this.$store.dispatch("Provider/connect")},disconnect(){this.$store.dispatch("Provider/disconnect")}}},c=l,d=n(1001),p=(0,d.Z)(c,a,r,!1,null,null,null),u=p.exports,h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"wrapper"},[e("message-modal",{attrs:{name:"canvas-message-modal",message:t.errorMessage}}),e("claim-modal",{attrs:{name:"claim-modal",width:t.selectedWidth,height:t.selectedHeight,x:t.selectionStartX,y:t.selectionStartY,onsuccess:t.onClaimModalSuccess,onerror:t.onClaimModalError},on:{close:t.closeClaimModal}}),e("div",{staticClass:"canvas-container",on:{click:t.click,mouseup:t.onMouseUp,mouseleave:t.onMouseLeave,mousedown:t.onMouseDown,mousemove:t.onMouseMove}},[e("canvas",{ref:"canvas",staticClass:"main-canvas",attrs:{width:"1000",height:"1000"}}),e("canvas",{ref:"canvasOld",staticClass:"old-canvas",style:t.oldCanvasStyles,attrs:{width:"1000",height:"1000"}}),e("div",{staticClass:"hover-popup",style:t.highLightPopupStyles},[t._v(" "+t._s(t.highlightNftDescription)+" ")]),e("div",{style:t.selectionHeaderStyle},[t._v(" "+t._s(t.selectedWidth)+"x"+t._s(t.selectedHeight)+" ")]),e("div",{style:t.selectionStyles}),t._l(t.badTiles,(function(n){return e("div",{key:n.index},[e("div",{style:t.styleForBadTile(n)})])})),e("br")],2),null===this.selectionStartX||this.selectionInProcess?t._e():e("button",{staticClass:"primary-button mint-button",on:{click:t.claim}},[t._v(" Mint segment ")])],1)},m=[],f=(n(7658),function(){var t=this,e=t._self._c;return e("modal",{staticClass:"claim-modal",attrs:{name:t.$props.name,height:"auto"},on:{"before-close":t.beforeClose,"before-open":t.beforeOpen}},[e("div",{staticClass:"flex modal-content"},[e("div",{staticClass:"claim-modal-header"},[t._v(" "+t._s(t.headerText)+" "),e("img",{staticClass:"close",attrs:{src:`${t.publicPath}icons/close.svg`,alt:"close"},on:{click:function(e){return t.$emit("close")}}})]),e("div",{staticClass:"flex claim-modal-content"},[t.claimInProgress?e("div",{staticStyle:{"background-color":"rgba(0, 0, 0, 0.3)",position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}}):t._e(),t.canBeClaimed?e("div",{staticClass:"instructions"},[t._v(" You have selected a "+t._s(this.width)+"x"+t._s(this.height)+"px segment ")]):e("div",{staticClass:"instructions"},[t._v(" Please upload a picture "+t._s(this.width)+"x"+t._s(this.height)+"px. ")]),e("label",{staticClass:"file-upload",attrs:{for:"assetsFieldHandle"}},[e("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",multiple:"",name:"fields[assetsFieldHandle][]",id:"assetsFieldHandle",accept:".pdf,.jpg,.jpeg,.png"},on:{change:t.onChange}}),e("button",{staticClass:"transparent-button"},[t._v("Select Image")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.canBeClaimed,expression:"canBeClaimed"}],staticClass:"canvasContainer",style:t.canvasContainerStyles},[e("canvas",{ref:"canvas",style:t.canvasContainerStyles,attrs:{width:this.$props.width,height:this.$props.height}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.canBeClaimed,expression:"canBeClaimed"}],staticClass:"slider"},[e("label",{class:{selected:"cover"===t.resizeMode},on:{click:function(e){return t.setResizeMode("cover")}}},[e("div",[t._v("Cover")])]),e("label",{class:{selected:"contain"===t.resizeMode},on:{click:function(e){return t.setResizeMode("contain")}}},[e("div",[t._v("Contain")])]),e("label",{class:{selected:"fill"===t.resizeMode},on:{click:function(e){return t.setResizeMode("fill")}}},[e("div",[t._v("Fill")])])]),t.canBeClaimed?e("form",[e("div",{staticClass:"flex description"},[e("label",{attrs:{for:"description"}},[t._v("Title:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"input",attrs:{type:"text",id:"description",maxlength:"1000"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})]),e("div",{staticClass:"flex link"},[e("label",{attrs:{for:"link"}},[t._v("Link:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.link,expression:"link"}],staticClass:"input",attrs:{type:"text",id:"link",maxlength:"1000"},domProps:{value:t.link},on:{input:[function(e){e.target.composing||(t.link=e.target.value)},function(e){return t.inputLink(e)}]}})]),t.linkValid?t._e():e("div",{staticClass:"error"},[t._v("Link format is not correct")]),e("button",{staticClass:"primary-button",on:{click:t.claim}},[t._v(" "+t._s(t.$props.id?"Edit segment":`Mint for ${this.mintingPrice} V`)+" ")])]):t._e(),t.claimInProgress?e("div",{staticClass:"claim-in-progress"},[e("span",[t._v(t._s(t.$props.id?"Edit in progress":"Claim in progress"))]),e("div",{staticClass:"lds-ring"},[e("div"),e("div"),e("div"),e("div")])]):t._e()])])])}),y=[],g=(n(2062),n(3054));const v=Array(400).fill(255);function w(){return v}function x(t){let e=[];for(let n=0;n<10;n++){let i=new g.BN(t.r[n]),s=new g.BN(t.g[n]),o=new g.BN(t.b[n]);for(let t=0;t<10;t++)e.push(i.shrn(8*(9-t)).and(new g.BN("255",10)).toNumber()),e.push(s.shrn(8*(9-t)).and(new g.BN("255",10)).toNumber()),e.push(o.shrn(8*(9-t)).and(new g.BN("255",10)).toNumber()),e.push(255)}return e}function b(t){const e={r:[],b:[],g:[]};for(let n=0;n<10;n++){let i=new g.BN("0",10),s=new g.BN("0",10),o=new g.BN("0",10);for(let e=0;e<10;e++)i=i.shln(0===e?0:8).or(new g.BN(t[4*e+0+10*n*4].toString(10),10)),s=s.shln(0===e?0:8).or(new g.BN(t[4*e+1+10*n*4].toString(10),10)),o=o.shln(0===e?0:8).or(new g.BN(t[4*e+2+10*n*4].toString(10),10));e.r.push(i.toString(10)),e.g.push(s.toString(10)),e.b.push(o.toString(10))}return e}var C=n(1929),I=n.n(C),P={name:"ClaimModal",data:function(){return{image:null,resizeMode:"cover",coloredTiles:[],claimInProgress:!1,description:"",link:"",publicPath:"/",linkValid:!0}},props:["id","name","x","y","width","height","onsuccess","onerror","onclose"],computed:{canBeClaimed:function(){return this.coloredTiles.length>0},canvasContainerStyles:function(){return this.$props.width>300||this.$props.height>300?{margin:"auto",width:`${this.$props.width}px`,height:`${this.$props.height}px`}:this.$props.width>60||this.$props.height>60?{margin:"auto",width:2*this.$props.width+"px",height:2*this.$props.height+"px"}:{margin:"auto",width:4*this.$props.width+"px",height:4*this.$props.height+"px"}},headerText(){return this.canBeClaimed?this.$props.id?"Editing":"Minting":"Choosing a picture"},mintingPrice(){return(parseInt(this.$store.state.Provider.currentTilePrice)*(this.$props.width*this.$props.height/100)/1e9).toFixed(1)}},methods:{setResizeMode(t){this.resizeMode=t,this.redraw()},redraw(){const t=this.$refs.canvas.getContext("2d");t.imageSmoothingEnabled=!1;const e=this.$props.width,n=this.$props.height;t.fillStyle="black",t.fillRect(0,0,e,n);const i=[],s=I().create();let o;if("contain"===this.resizeMode)o={source:this.image,maxWidth:e,maxHeight:n,minWidth:e/2,minHeight:n/2,proportional:!0,output:"image",quality:1};else if("cover"===this.resizeMode){const t=this.image.width/this.image.height,i=e/n;o=i<t?{source:this.image,width:Math.floor(n*t),height:n,proportional:!0,output:"image",quality:1}:{source:this.image,width:e,height:Math.floor(e/t),proportional:!0,output:"image",quality:1}}else o={source:this.image,width:e,height:n,proportional:!1,output:"image",quality:1};s(o).then((s=>{if("contain"===this.resizeMode){const i=s.width/s.height;let o,a;e/n>i?(a=n,o=a*i):(o=e,a=o/i);const r=(e-o)/2,l=(n-a)/2;t.drawImage(s,r,l,s.width,s.height)}else"cover"===this.resizeMode?s.width>e?t.drawImage(s,-1*Math.floor((s.width-e)/2),0,s.width,s.height):t.drawImage(s,0,-1*Math.floor((s.height-n)/2),s.width,s.height):t.drawImage(s,0,0,e,n);for(let o=0;o<n/10;o++)for(let n=0;n<e/10;n++){const e=t.getImageData(10*n,10*o,10,10);i.push(b(e.data))}this.coloredTiles=i}))},onChange(){const t=new Image;t.onload=function(){this.image=t,this.redraw()}.bind(this),t.src=URL.createObjectURL(this.$refs.file.files[0])},claim(t){if(t.preventDefault(),this.claimInProgress)return;const e=this.description,n=this.link,i=/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-/]))?/;if(i.test(n)){let t;this.linkValid=!0,t=this.$props.id?this.$store.dispatch("Provider/redrawNft",{id:this.$props.id,x:this.$props.x,y:this.$props.y,width:this.$props.width,height:this.$props.height,tiles:this.coloredTiles,description:e,url:n}):this.$store.dispatch("Provider/claimTiles",{x:this.$props.x,y:this.$props.y,width:this.$props.width,height:this.$props.height,tiles:this.coloredTiles,description:e,url:n}),t&&(this.claimInProgress=!0,t.then((()=>{this.claimInProgress=!1,this.$props.onsuccess()})).catch((t=>{console.log(t),this.claimInProgress=!1,this.$props.id||3===t.code||(console.log("on error"),this.onerror(t.message))})))}else this.linkValid=!1},beforeClose(t){this.claimInProgress&&t.cancel()},beforeOpen(){this.description="",this.link="",this.coloredTiles=[]},inputLink(){this.linkValid=!0}}},S=P,_=(0,d.Z)(S,f,y,!1,null,"b7e90ce4",null),$=_.exports,E=function(){var t=this,e=t._self._c;return e("modal",{staticClass:"message-modal",attrs:{name:t.$props.name,height:"auto"}},[e("div",{staticClass:"flex modal-content"},[e("div",{staticClass:"flex message-modal-content"},[e("div",{staticClass:"instructions"},[t._v(" "+t._s(t.$props.message)+" ")]),e("button",{staticClass:"primary-button",on:{click:this.close}},[t._v(" Close ")])])])])},N=[],M={name:"MessageModal",data:function(){return{}},props:["name","message"],computed:{},methods:{close(){this.$modal.hide(this.name)}}},k=M,T=(0,d.Z)(k,E,N,!1,null,"e14c4b00",null),X=T.exports,B={name:"CanvasComponent",components:{ClaimModal:$,MessageModal:X},props:["isEditingMode"],data(){return{ctx:null,ctxOld:null,imageData:null,isMobile:!1,collectionLoaded:!1,selectionInProcess:!1,selectionStartX:null,selectionStartY:null,selectionEndX:null,selectionEndY:null,highLightNftId:null,lastMousePosX:0,lastMousePosY:0,selectionTriedCounter:0,errorMessage:""}},computed:{hideOldCanvas:function(){return this.isEditingMode||this.selectionTriedCounter>0||this.selectionInProcess},oldCanvasStyles:function(){return this.hideOldCanvas?{}:{visibility:"visible",opacity:1,transition:"opacity 250ms ease-in, visibility 0ms ease-in 0ms"}},badTiles:function(){if(null===this.selectionStartX)return[];let t=this.selectionStartX,e=this.selectionStartY,n=this.selectionEndX,i=this.selectionEndY,s=[];for(let o=t;o<=n;o+=10)for(let t=e;t<=i;t+=10){const e=10*o+t/10,n=this.$store.state.Provider.tilesByIndex[e];n.epoch===this.$store.state.Provider.epoch&&"4294967295"!==n.nftId&&s.push(n)}return s},selectedTilesCount:function(){return null===this.selectionStartX||null===this.selectionStartY?0:(this.selectionEndX-this.selectionStartX+10)/10*(this.selectionEndY-this.selectionStartY+10)/10},tiles:function(){return this.$store.state.Provider.tiles},selectedWidth:function(){return this.selectionEndX-this.selectionStartX+10},selectedHeight:function(){return this.selectionEndY-this.selectionStartY+10},selectedPriceUSD:function(){return this.selectedWidth*this.selectedHeight*1e9},highLightPopupStyles:function(){if(this.highLightNftId&&!this.selectionInProcess){const t=this.lastMousePosX>600;return{top:`${this.lastMousePosY}px`,left:`${t?this.lastMousePosX-235:this.lastMousePosX+15}px`,width:"200px",minHeight:"20px"}}return{display:"none"}},highlightNftDescription(){let t=this.$store.state.Provider.nftDataById,e=t[this.highLightNftId];return e?e.description:""},selectionStyles:function(){return null!==this.selectionStartX?{position:"absolute",left:`${this.selectionStartX}px`,top:`${this.selectionStartY}px`,width:this.selectionEndX-this.selectionStartX+10+"px",height:this.selectionEndY-this.selectionStartY+10+"px",backgroundColor:"rgba(204,255,0,0.5)"}:{position:"absolute",left:0,top:0,width:0,height:0,backgroundColor:"rgba(204,255,0,0.5)"}},selectionHeaderStyle:function(){return null!==this.selectionStartX?this.selectionStartY>100?{position:"absolute",left:(this.selectionStartX+this.selectionEndX)/2-30+"px",top:this.selectionStartY-25+"px",width:"60px",height:"20px",borderRadius:"5px",backgroundColor:"yellow",textAlign:"center"}:{position:"absolute",left:(this.selectionStartX+this.selectionEndX)/2-30+"px",top:`${this.selectionEndY+15}px`,width:"60px",height:"20px",borderRadius:"5px",backgroundColor:"yellow",textAlign:"center"}:{display:"none",position:"absolute",left:0,top:0,width:0,height:0,backgroundColor:"rgba(204,255,0,0.5)"}}},mounted(){this.ctx=this.$refs.canvas.getContext("2d"),this.ctxOld=this.$refs.canvasOld.getContext("2d"),this.imageData=this.ctx.createImageData(10,10),this.$store.subscribe((t=>{"Provider/setCollection"===t.type?this.redraw(t.payload.tilesByIndex,this.$store.state.Provider.epoch):"Provider/setTile"===t.type?this.drawTile(t.payload.tile,this.$store.state.Provider.epoch):"Provider/setEpoch"===t.type&&this.redraw(this.$store.state.Provider.tilesByIndex,t.payload.epoch)}))},methods:{clearSelection(){this.selectionInProcess=!1,this.selectionStartX=null,this.selectionStartY=null,this.selectionEndX=null,this.selectionEndY=null},drawTile(t,e){this.imageData.data.set(t.pixels),t.epoch===e?(this.ctx.putImageData(this.imageData,t.x,t.y),this.ctxOld.clearRect(t.x,t.y,10,10)):this.ctxOld.putImageData(this.imageData,t.x,t.y)},redraw(t,e){this.ctx.clearRect(0,0,1e3,1e3),this.ctxOld.clearRect(0,0,1e3,1e3);for(let n in t)this.imageData.data.set(t[n].pixels),t[n].epoch===e?this.ctx.putImageData(this.imageData,t[n].x,t[n].y):this.ctxOld.putImageData(this.imageData,t[n].x,t[n].y);this.collectionLoaded=!0},styleForBadTile:function(t){return{position:"absolute",left:`${t.x}px`,top:`${t.y}px`,width:"10px",height:"10px",backgroundColor:"red"}},onMouseDown(t){if(this.isMobile||!this.collectionLoaded)return;setTimeout((()=>{this.selectionInProcess&&(this.selectionTriedCounter+=1,setTimeout((()=>{this.selectionTriedCounter-=1}),5e3))}),200);const e=this.$refs.canvas.getBoundingClientRect();let n=10*Math.floor((t.clientX-e.left)/10),i=10*Math.floor((t.clientY-e.top)/10);n<0||n>990||i<0||i>990||(this.selectionInProcess=!0,this.selectionStartX=n,this.selectionStartY=i,this.selectionEndX=n,this.selectionEndY=i)},onMouseMove(t){if(this.isMobile||!this.collectionLoaded)return;const e=this.$refs.canvas.getBoundingClientRect();let n=t.clientX-e.left,i=t.clientY-e.top,s=10*Math.floor(n/10),o=10*Math.floor(i/10);if(!(s<0||s>990||o<0||o>990))if(this.selectionInProcess){if(s<=this.selectionEndX)this.selectionEndX=Math.max(s,this.selectionStartX);else while(s>this.selectionEndX){let t=(this.selectionEndX-this.selectionStartX+20)*(this.selectionEndY-this.selectionStartY+10);if(!(t<=9e3))break;this.selectionEndX+=10}if(o<=this.selectionEndY)this.selectionEndY=Math.max(o,this.selectionStartY);else while(o>this.selectionEndY){let t=(this.selectionEndX-this.selectionStartX+10)*(this.selectionEndY-this.selectionStartY+20);if(!(t<=9e3))break;this.selectionEndY+=10}}else{this.lastMousePosX=n,this.lastMousePosY=i;const t=10*s+o/10,e=this.$store.state.Provider.tilesByIndex[t];!e||"4294967295"===e.nftId||e.nftId===this.highLightNftId||this.hideOldCanvas&&e.epoch!==this.$store.state.Provider.epoch?e.nftId!==this.highLightNftId&&(this.highLightNftId=null):(this.highLightNftId=e.nftId,setTimeout((()=>{this.highLightNftId===e.nftId&&this.$store.dispatch("Provider/fetchNftData",{id:e.nftId})}),1e3))}},onMouseUp(){if(!this.isMobile&&this.collectionLoaded){if(this.selectionInProcess=!1,null!==this.selectionStartX&&this.selectionStartX===this.selectionEndX&&this.selectionStartY===this.selectionEndY&&this.highLightNftId){let t=this.$store.state.Provider.nftDataById[this.highLightNftId];t&&t.url&&window.open(t.url,"_blank")}this.badTiles.length>0&&this.clearSelection()}},onMouseLeave(){this.isMobile||(this.selectionInProcess&&this.clearSelection(),this.highLightNftId=null)},click(t){if(!this.isMobile||!this.collectionLoaded)return;const e=this.$refs.canvas.getBoundingClientRect();let n=t.clientX-e.left,i=t.clientY-e.top,s=10*Math.floor(n/10),o=10*Math.floor(i/10);if(null!==this.selectionStartX&&this.selectionStartX===this.selectionEndX&&this.selectionStartY===this.selectionEndY){let t={selectionStartX:this.selectionStartX,selectionStartY:this.selectionStartY,selectionEndX:this.selectionEndX,selectionEndY:this.selectionEndY};this.selectionStartX=Math.min(s,t.selectionStartX),this.selectionStartY=Math.min(o,t.selectionStartY),this.selectionEndX=Math.max(s,t.selectionEndX),this.selectionEndY=Math.max(o,t.selectionEndY)}else this.selectionStartX=s,this.selectionStartY=o,this.selectionEndX=s,this.selectionEndY=o;while((this.selectionEndX-this.selectionStartX+10)*(this.selectionEndY-this.selectionStartY+10)>1e4)Math.random()>.5?this.selectionEndX>this.selectionStartX&&(this.selectionEndX-=10):this.selectionEndY>this.selectionStartY&&(this.selectionEndY-=10);console.log("no error?");const a=this.tiles.filter((t=>"4294967295"!==t.nftId&&t.x>=this.selectionStartX&&t.y>=this.selectionStartY&&t.x<=this.selectionEndX&&t.y<=this.selectionEndY));0!==a.length&&(this.selectionStartX=null,this.selectionStartY=null,this.selectionEndX=null,this.selectionEndY=null)},claim(){this.$store.state.Provider.account?this.$modal.show("claim-modal"):this.$store.dispatch("Provider/connect")},onClaimModalSuccess(){this.clearSelection(),this.$modal.hide("claim-modal")},onClaimModalError(t){this.errorMessage=t,this.$modal.hide("claim-modal"),this.$modal.show("canvas-message-modal")},closeClaimModal(){this.$modal.hide("claim-modal")}}},Y=B,D=(0,d.Z)(Y,h,m,!1,null,"c40f4dee",null),O=D.exports,L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"full-screen-popup"},[e("message-modal",{attrs:{name:"nft-message-modal",message:t.message}}),e("div",{staticClass:"full-screen-popup-fade",on:{click:t.$props.onClose}}),e("div",{staticClass:"my-nft-wrapper"},[e("div",{staticClass:"my-nft-header"},[t._v(" My NFTs "),e("img",{staticClass:"close",attrs:{src:`${t.publicPath}icons/close.svg`,alt:"close"},on:{click:t.$props.onClose}})]),e("div",{staticClass:"my-nft-container"},t._l(t.nfts,(function(n){return e("div",{key:n.id,staticClass:"my-nft"},[e("OneNftComponent",{attrs:{onError:t.onError,address:n.address,id:n.id,lockedAmount:n.lockedAmount,x:n.x,y:n.y,width:n.width,height:n.height,description:n.description,url:n.url,onedit:t.onEdit}})],1)})),0)]),e("claim-modal",{attrs:{name:"edit-modal",id:t.editNftId,width:t.editNftWidth,height:t.editNftHeight,x:t.editNftX,y:t.editNftY,onsuccess:t.onModalSuccess},on:{close:t.closEditModal}})],1)},A=[],F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nft-container"},[e("div",{staticClass:"canvas-container",style:t.canvasStyles},[e("a",{attrs:{href:t.scanLink,target:"_blank"}},[e("canvas",{ref:"canvas",style:t.canvasStyles,attrs:{width:this.$props.width,height:this.$props.height}})])]),e("div",{staticClass:"nft-info-container"},[e("div",{staticClass:"nft-info-title"},[e("a",{attrs:{href:t.$props.url,target:"_blank"}},[t._v(" "+t._s(this.$props.description)+" ")])]),e("div",{staticClass:"secondary-button nft-info-button",on:{click:t.edit}},[e("span",[t._v(" Edit ")]),e("img",{staticClass:"edit-icon",attrs:{src:`${t.publicPath}icons/edit.svg`,alt:"edit"}})]),e("div",{staticClass:"secondary-button nft-info-button",on:{click:t.burn}},[e("span",[t._v(" Burn ")]),e("img",{staticClass:"burn-icon",attrs:{src:`${t.publicPath}icons/burn.svg`,alt:"burn"}})])]),e("div",{staticClass:"nft-subinfo-container"},[e("p",[t._v(" "+t._s(this.visiblyText)+" ")]),e("p",[t._v(" Locked value: "+t._s(this.beautyValue)+" Venom ")])])])},V=[],H={name:"OneNft",data(){return{publicPath:"/"}},props:["id","address","x","y","width","height","description","url","onedit","lockedAmount","onError"],computed:{canvasStyles:function(){const t=250/this.$props.width*this.$props.height;return{margin:"3px auto",width:"100%",height:`${t}px`}},scanLink:function(){return`https://devnet.venomscan.com/accounts/${this.$props.address.toString()}`},beautyValue:function(){return(parseInt(this.$props.lockedAmount)/1e9).toFixed(2)},visiblyText:function(){return this.isFullyVisible?"This segment is fully visible.":this.isPartialVisible?"This segment is partially visible.":"This segment is invisible."},isFullyVisible:function(){let t=!0;for(let e=this.$props.x;e<this.$props.x+this.$props.width;e+=10){for(let n=this.$props.y;n<this.$props.y+this.$props.height;n+=10){const i=10*e+n/10;if(this.$store.state.Provider.tilesByIndex[i].nftId!==this.$props.id){t=!1;break}}if(!t)break}return t},isPartialVisible:function(){let t=!1;for(let e=this.$props.x;e<this.$props.x+this.$props.width;e+=10){for(let n=this.$props.y;n<this.$props.y+this.$props.height;n+=10){const i=10*e+n/10;if(this.$store.state.Provider.tilesByIndex[i].nftId===this.$props.id){t=!0;break}}if(t)break}return t}},mounted(){this.redraw()},methods:{edit(){this.isPartialVisible?this.$props.onedit(this.$props.id,this.$props.x,this.$props.y,this.$props.width,this.$props.height):this.onError("Your nft was completely covered by new NFTs and become invisible. You can burn it to get locked value back.")},burn(){this.isFullyVisible?this.onError("Your NFT can only be burned if it is completely covered by new NFTs."):this.isPartialVisible?this.onError("Your NFT can only be burned if it is completely covered by new NFTs. Now it is partially visible."):this.$store.dispatch("Provider/burnNft",this.$props.id)},floorPrice(){return this.$props.width*this.$props.height},redraw(){const t=this.$refs.canvas.getContext("2d"),e=t.createImageData(10,10);for(let n=this.$props.x;n<this.$props.x+this.$props.width;n+=10)for(let i=this.$props.y;i<this.$props.y+this.$props.height;i+=10){const s=10*n+i/10,o=this.$store.state.Provider.tilesByIndex[s];o&&(e.data.set(o.pixels),t.putImageData(e,n-this.$props.x,i-this.$props.y))}}}},R=H,j=(0,d.Z)(R,F,V,!1,null,"0265c7c7",null),z=j.exports,U={name:"MyNftComponent",components:{OneNftComponent:z,ClaimModal:$,MessageModal:X},data(){return{publicPath:"/",editNftId:null,editNftWidth:null,editNftHeight:null,editNftX:null,editNftY:null,message:""}},props:["onClose"],computed:{address(){return""},nfts(){return this.$store.state.Provider.userNfts}},mounted(){},methods:{onError(t){this.message=t,this.$modal.show("nft-message-modal")},onEdit(t,e,n,i,s){this.editNftId=t,this.editNftX=e,this.editNftY=n,this.editNftWidth=i,this.editNftHeight=s,this.$modal.show("edit-modal")},onModalSuccess(){this.editNftId=null,this.$modal.hide("edit-modal"),this.$props.onClose()},closEditModal(){this.editNftId=null,this.$modal.hide("edit-modal")}}},W=U,Z=(0,d.Z)(W,L,A,!1,null,"2a0d0b18",null),G=Z.exports,q={name:"App",components:{HeaderComponent:u,CanvasComponent:O,MyNftComponent:G},data(){return{myNftOpened:!1,isEditingMode:!1,message:"Its okay to be not okay"}},computed:{isCollectionLoaded(){return this.$store.state.Provider.collectionLoaded}},mounted(){this.$store.dispatch("Provider/init",{})},methods:{closeMyNfts(){this.myNftOpened=!1},openMyNfts(){this.myNftOpened=!0},toggleEditingMode(){this.isEditingMode=!this.isEditingMode},showError(t){this.message=t,this.$modal.show("message-modal")}}},J=q,K=(0,d.Z)(J,s,o,!1,null,null,null),Q=K.exports,tt=n(408),et=n(2260),nt=n(2697),it=n(2131),st=JSON.parse('{"ABI version":2,"version":"2.3","header":["time"],"functions":[{"name":"constructor","inputs":[{"name":"codeNft","type":"cell"},{"name":"codeIndex","type":"cell"},{"name":"codeIndexBasis","type":"cell"},{"name":"jsonMetadata","type":"string"}],"outputs":[]},{"name":"changeOwner","inputs":[{"name":"newOwner","type":"address"}],"outputs":[]},{"name":"disableMint","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"value0","type":"bool"}]},{"name":"enableMint","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"value0","type":"bool"}]},{"name":"getMintDisabled","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"value0","type":"bool"}]},{"name":"changeEpoch","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"value0","type":"uint32"},{"name":"value1","type":"uint128"}]},{"name":"setNftBurningBlocked","inputs":[{"name":"nftId","type":"uint32"},{"name":"isBlocked","type":"bool"}],"outputs":[]},{"name":"claimTiles","inputs":[{"name":"pixelStartX","type":"uint10"},{"name":"pixelStartY","type":"uint10"},{"name":"pixelEndX","type":"uint10"},{"name":"pixelEndY","type":"uint10"},{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tilesToColorify","type":"tuple[]"},{"name":"description","type":"string"},{"name":"url","type":"string"},{"name":"coinsToRedrawOneTile","type":"uint128"}],"outputs":[]},{"name":"colorifyTile","inputs":[{"name":"nftId","type":"uint32"},{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tileColors","type":"tuple"},{"name":"tilePixelX","type":"uint10"},{"name":"tilePixelY","type":"uint10"},{"name":"sendGasBack","type":"address"}],"outputs":[]},{"name":"burnNft","inputs":[{"name":"nftId","type":"uint32"},{"name":"lockedAmount","type":"uint128"},{"name":"nftPixelStartX","type":"uint10"},{"name":"nftPixelStartY","type":"uint10"},{"name":"nftPixelEndX","type":"uint10"},{"name":"nftPixelEndY","type":"uint10"}],"outputs":[]},{"name":"getTile","inputs":[{"name":"answerId","type":"uint32"},{"name":"tilePixelX","type":"uint10"},{"name":"tilePixelY","type":"uint10"}],"outputs":[{"name":"pixels","type":"uint8[]"},{"name":"nftId","type":"uint32"},{"name":"epoch","type":"uint32"}]},{"name":"convertTileColorsToPixels","inputs":[{"name":"answerId","type":"uint32"},{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tileColors","type":"tuple"}],"outputs":[{"name":"pixels","type":"uint8[]"}]},{"name":"getTilesColors","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"value0","type":"map(uint14,tuple)"}]},{"name":"getTilesOwners","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"value0","type":"map(uint14,uint64)"}]},{"name":"getData","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"nftCounter","type":"uint32"},{"name":"epoch","type":"uint32"},{"name":"currentEpochPixelTilePrice","type":"uint128"},{"name":"mintDisabled","type":"bool"}]},{"name":"getNftIndexCodeHash","inputs":[{"name":"answerId","type":"uint32"},{"name":"_owner","type":"address"}],"outputs":[{"name":"codeHash","type":"string"}]},{"name":"indexBasisCode","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"code","type":"cell"}]},{"name":"indexBasisCodeHash","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"hash","type":"uint256"}]},{"name":"resolveIndexBasis","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"indexBasis","type":"address"}]},{"name":"indexCode","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"code","type":"cell"}]},{"name":"indexCodeHash","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"hash","type":"uint256"}]},{"name":"getJson","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"json","type":"string"}]},{"name":"totalSupply","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"count","type":"uint128"}]},{"name":"nftCode","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"code","type":"cell"}]},{"name":"nftCodeHash","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"codeHash","type":"uint256"}]},{"name":"nftAddress","inputs":[{"name":"answerId","type":"uint32"},{"name":"id","type":"uint256"}],"outputs":[{"name":"nft","type":"address"}]},{"name":"supportsInterface","inputs":[{"name":"answerId","type":"uint32"},{"name":"interfaceID","type":"uint32"}],"outputs":[{"name":"value0","type":"bool"}]}],"data":[{"key":1,"name":"owner_","type":"address"},{"key":2,"name":"nonce_","type":"uint16"}],"events":[{"name":"MintDisabledChanged","inputs":[{"name":"newValue","type":"bool"}],"outputs":[]},{"name":"TileColorify","inputs":[{"name":"nftId","type":"uint32"},{"name":"nftEpoch","type":"uint32"},{"name":"pixelStartX","type":"uint10"},{"name":"pixelStartY","type":"uint10"},{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tileColors","type":"tuple"}],"outputs":[]},{"name":"NftMinted","inputs":[{"name":"nftId","type":"uint32"},{"name":"nftEpoch","type":"uint32"},{"name":"owner","type":"address"},{"name":"pixelStartX","type":"uint10"},{"name":"pixelStartY","type":"uint10"},{"name":"pixelEndX","type":"uint10"},{"name":"pixelEndY","type":"uint10"}],"outputs":[]},{"name":"EpochChanged","inputs":[{"name":"newEpoch","type":"uint32"},{"name":"oneTileClaimPrice","type":"uint128"}],"outputs":[]},{"name":"NftCreated","inputs":[{"name":"id","type":"uint256"},{"name":"nft","type":"address"},{"name":"owner","type":"address"},{"name":"manager","type":"address"},{"name":"creator","type":"address"}],"outputs":[]},{"name":"NftBurned","inputs":[{"name":"id","type":"uint256"},{"name":"nft","type":"address"},{"name":"owner","type":"address"},{"name":"manager","type":"address"}],"outputs":[]}],"fields":[{"name":"_pubkey","type":"uint256"},{"name":"_timestamp","type":"uint64"},{"name":"_constructorFlag","type":"bool"},{"name":"_supportedInterfaces","type":"optional(cell)"},{"name":"_codeNft","type":"cell"},{"name":"_totalSupply","type":"uint128"},{"name":"_json","type":"string"},{"name":"_codeIndex","type":"cell"},{"name":"_codeIndexBasis","type":"cell"},{"name":"_indexDeployValue","type":"uint128"},{"name":"_indexDestroyValue","type":"uint128"},{"name":"_deployIndexBasisValue","type":"uint128"},{"name":"owner_","type":"address"},{"name":"nonce_","type":"uint16"},{"name":"mintDisabled_","type":"bool"},{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tiles_","type":"map(uint14,tuple)"},{"name":"tileOwner_","type":"map(uint14,uint64)"},{"name":"nftCounter_","type":"uint32"},{"name":"currentEpoch_","type":"uint32"},{"name":"currentEpochTilesLeft_","type":"uint14"},{"name":"currentEpochPixelTilePrice_","type":"uint128"},{"name":"epochTilePriceGrow_","type":"uint128"}]}'),ot=JSON.parse('{"ABI version":2,"version":"2.3","header":["time"],"functions":[{"name":"constructor","inputs":[{"name":"owner","type":"address"},{"name":"sendGasTo","type":"address"},{"name":"remainOnNft","type":"uint128"},{"name":"indexDeployValue","type":"uint128"},{"name":"indexDestroyValue","type":"uint128"},{"name":"codeIndex","type":"cell"},{"name":"lockedAmount","type":"uint128"},{"name":"nftPixelsStartX","type":"uint10"},{"name":"nftPixelsStartY","type":"uint10"},{"name":"nftPixelsEndX","type":"uint10"},{"name":"nftPixelsEndY","type":"uint10"},{"name":"description","type":"string"},{"name":"url","type":"string"}],"outputs":[]},{"name":"getJson","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"json","type":"string"}]},{"name":"getNftCustomData","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"id","type":"uint256"},{"name":"owner","type":"address"},{"name":"collection","type":"address"},{"name":"lockedAmount","type":"uint128"},{"name":"description","type":"string"},{"name":"url","type":"string"},{"name":"tilePixelsStartX","type":"uint10"},{"name":"tilePixelsStartY","type":"uint10"},{"name":"tilePixelsEndX","type":"uint10"},{"name":"tilePixelsEndY","type":"uint10"}]},{"name":"colorify","inputs":[{"components":[{"name":"r","type":"uint80[]"},{"name":"g","type":"uint80[]"},{"name":"b","type":"uint80[]"}],"name":"tilesToColorify","type":"tuple[]"},{"name":"description","type":"string"},{"name":"url","type":"string"},{"name":"coinsToRedrawOneTile","type":"uint128"},{"name":"sendGasBack","type":"address"}],"outputs":[]},{"name":"setBurningBlocked","inputs":[{"name":"isBlocked","type":"bool"},{"name":"sendGasBack","type":"address"}],"outputs":[]},{"name":"burnNft","inputs":[],"outputs":[]},{"name":"onBurnSuccess","inputs":[],"outputs":[]},{"name":"onBurnError","inputs":[],"outputs":[]},{"name":"indexCode","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"code","type":"cell"}]},{"name":"indexCodeHash","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"hash","type":"uint256"}]},{"name":"resolveIndex","inputs":[{"name":"answerId","type":"uint32"},{"name":"collection","type":"address"},{"name":"owner","type":"address"}],"outputs":[{"name":"index","type":"address"}]},{"name":"transfer","inputs":[{"name":"to","type":"address"},{"name":"sendGasTo","type":"address"},{"components":[{"name":"value","type":"uint128"},{"name":"payload","type":"cell"}],"name":"callbacks","type":"map(address,tuple)"}],"outputs":[]},{"name":"changeOwner","inputs":[{"name":"newOwner","type":"address"},{"name":"sendGasTo","type":"address"},{"components":[{"name":"value","type":"uint128"},{"name":"payload","type":"cell"}],"name":"callbacks","type":"map(address,tuple)"}],"outputs":[]},{"name":"changeManager","inputs":[{"name":"newManager","type":"address"},{"name":"sendGasTo","type":"address"},{"components":[{"name":"value","type":"uint128"},{"name":"payload","type":"cell"}],"name":"callbacks","type":"map(address,tuple)"}],"outputs":[]},{"name":"getInfo","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"id","type":"uint256"},{"name":"owner","type":"address"},{"name":"manager","type":"address"},{"name":"collection","type":"address"}]},{"name":"supportsInterface","inputs":[{"name":"answerId","type":"uint32"},{"name":"interfaceID","type":"uint32"}],"outputs":[{"name":"value0","type":"bool"}]}],"data":[{"key":1,"name":"_id","type":"uint256"}],"events":[{"name":"NftCreated","inputs":[{"name":"id","type":"uint256"},{"name":"owner","type":"address"},{"name":"manager","type":"address"},{"name":"collection","type":"address"}],"outputs":[]},{"name":"OwnerChanged","inputs":[{"name":"oldOwner","type":"address"},{"name":"newOwner","type":"address"}],"outputs":[]},{"name":"ManagerChanged","inputs":[{"name":"oldManager","type":"address"},{"name":"newManager","type":"address"}],"outputs":[]},{"name":"NftBurned","inputs":[{"name":"id","type":"uint256"},{"name":"owner","type":"address"},{"name":"manager","type":"address"},{"name":"collection","type":"address"}],"outputs":[]}],"fields":[{"name":"_pubkey","type":"uint256"},{"name":"_timestamp","type":"uint64"},{"name":"_constructorFlag","type":"bool"},{"name":"_supportedInterfaces","type":"optional(cell)"},{"name":"_id","type":"uint256"},{"name":"_collection","type":"address"},{"name":"_owner","type":"address"},{"name":"_manager","type":"address"},{"name":"_indexDeployValue","type":"uint128"},{"name":"_indexDestroyValue","type":"uint128"},{"name":"_codeIndex","type":"cell"},{"name":"nftPixelsStartX_","type":"uint10"},{"name":"nftPixelsStartY_","type":"uint10"},{"name":"nftPixelsEndX_","type":"uint10"},{"name":"nftPixelsEndY_","type":"uint10"},{"name":"remainOnNft_","type":"uint128"},{"name":"lockedAmount_","type":"uint128"},{"name":"description_","type":"string"},{"name":"url_","type":"string"},{"name":"burnInProgress_","type":"bool"},{"name":"isBurningBlocked_","type":"bool"}]}'),at=JSON.parse('{"ABI version":2,"version":"2.2","header":["time"],"functions":[{"name":"constructor","inputs":[{"name":"collection","type":"address"}],"outputs":[]},{"name":"getInfo","inputs":[{"name":"answerId","type":"uint32"}],"outputs":[{"name":"collection","type":"address"},{"name":"owner","type":"address"},{"name":"nft","type":"address"}]},{"name":"destruct","inputs":[{"name":"gasReceiver","type":"address"}],"outputs":[]}],"data":[{"key":1,"name":"_nft","type":"address"}],"events":[],"fields":[{"name":"_pubkey","type":"uint256"},{"name":"_timestamp","type":"uint64"},{"name":"_constructorFlag","type":"bool"},{"name":"_nft","type":"address"},{"name":"_collection","type":"address"},{"name":"_owner","type":"address"}]}');const rt=new nt.Address("0:091ab4602f7a9d3c9055995d299aad89a7a4fc851cb995560b6a74492f14bc9d"),lt=.017,ct=.15,dt=.8,pt=.15,ut=1.1,ht=[],mt=()=>it.EverscaleStandaloneClient.create({connection:{id:1e3,group:"dev",type:"jrpc",data:{endpoint:"https://jrpc-testnet.venom.foundation/"}}});async function ft(t,e){let n;try{n=new t.Subscriber;const i=new t.Contract(st,rt);let s=!1,o=[];n.transactions(i.address).on((async t=>{console.log("We got a new transactions on collection address",t);for(let n of t.transactions.reverse()){let t=await i.decodeTransactionEvents({transaction:n});for(let n of t)if("TileColorify"===n.event){let t=parseInt(n.data.pixelStartX),i=parseInt(n.data.pixelStartY),a={index:t/10*100+i/10,nftId:n.data.nftId,epoch:n.data.nftEpoch,x:t,y:i,pixels:x(n.data.tileColors)};s?e("Provider/setTile",{tile:a}):o.push({type:"Provider/setTile",data:{tile:a}})}else if("NftMinted"===n.event){let t=parseInt(n.data.pixelStartX),i=parseInt(n.data.pixelStartY),a=parseInt(n.data.pixelEndX),r=parseInt(n.data.pixelEndY);for(let l=t/10;l<a/10;l++)for(let t=i/10;t<r/10;t++){let i={index:100*l+t,nftId:n.data.nftId,epoch:n.data.nftEpoch,x:10*l,y:10*t,pixels:w()};s?e("Provider/setTile",{tile:i}):o.push({type:"Provider/setTile",data:{tile:i}})}}else"MintDisabledChanged"===n.event?s?e("Provider/setMintDisabled",n.data.newValue):o.push({type:"Provider/setMintDisabled",data:n.data.newValue}):"EpochChanged"===n.event&&(s?e("Provider/setEpoch",{epoch:n.data.newEpoch,price:n.data.oneTileClaimPrice}):o.push({type:"Provider/setEpoch",data:{epoch:n.data.newEpoch,price:n.data.oneTileClaimPrice}}))}})),await new Promise((function(t,e){setTimeout(t,50)}));let a=Date.now();console.log("get new state");const{state:r}=await i.getFullState();console.log("state got",((Date.now()-a)/1e3).toFixed(1));let l={},c={},{fields:d}=await i.getFields({cachedState:r});console.log("state parsed",((Date.now()-a)/1e3).toFixed(1));for(let t of d.tiles_){let e=new g.BN(t[0]),n=parseInt(e.shrn(7).toString(10)),i=parseInt(e.and(new g.BN("127",10)).toString(10));const s=100*n+i;l[s]=x(t[1])}for(let t of d.tileOwner_){let e=new g.BN(t[0]),n=new g.BN(t[1]),i=parseInt(e.shrn(7).toString(10)),s=parseInt(e.and(new g.BN("127",10)).toString(10)),o=n.shrn(32).toString(10),a=n.and(new g.BN("4294967295",10)).toString(10);const r=100*i+s;let d={index:r,nftId:o,epoch:a,x:10*i,y:10*s,pixels:-1===ht.indexOf(o)&&l[r]||w()};c[r]=d}for(let t=0;t<100;t++)for(let e=0;e<100;e++){let n=100*e+t;if(!c[n]){const i={index:n,nftId:"4294967295",epoch:0,x:10*e,y:10*t,pixels:Array(400).fill(0)};c[n]=i}}e("Provider/setEpoch",{epoch:d.currentEpoch_,price:d.currentEpochPixelTilePrice_}),e("Provider/setMintDisabled",d.mintDisabled_),e("Provider/setCollection",{collectionContract:i,collectionCachedState:r,tilesByIndex:c,nftTvc:await t.codeToTvc(d._codeNft)}),s=!0;for(let t of o)console.log("pending events"),e(t.type,t.data);console.log("Parsed",((Date.now()-a)/1e3).toFixed(1))}catch(i){console.log("load collection error",i),n&&n.unsubscribe(),setTimeout((function(){ft(t,e)}),1e4)}}async function yt(t,e,n){e.getBalance(t).then((function(e){e&&n("Provider/setAccountBalance",{address:t,balance:(e/1e9).toFixed(1)})}))}async function gt(t,e,n,i,s){const{address:o}=await i.getStateInit(ot,{workchain:0,tvc:e,initParams:{_id:t}}),a=new i.Contract(ot,o);let r=await a.methods.getNftCustomData({answerId:0}).call({responsible:!0});s("setUserNft",{userAddress:n,nft:{address:o,id:r.id,owner:r.owner,lockedAmount:r.lockedAmount,description:r.description,url:r.url,x:parseInt(r.tilePixelsStartX),y:parseInt(r.tilePixelsStartY),width:parseInt(r.tilePixelsEndX)-parseInt(r.tilePixelsStartX),height:parseInt(r.tilePixelsEndY)-parseInt(r.tilePixelsStartY)}})}async function vt(t,e,n,i,s,o){console.log("Fetch users nfts!!!");const{codeHash:a}=await i.methods.getNftIndexCodeHash({answerId:0,_owner:t}).call({responsible:!0,cachedState:s});console.log("Got init code hash");const{accounts:r}=await e.getAccountsByCodeHash({codeHash:a});console.log("Got accounts");for(let c of r){console.log("Iterate",c);try{let s=new e.Contract(at,c),{owner:a,nft:r,collection:l}=await s.methods.getInfo({answerId:0}).call({responsible:!0});const d=new e.Contract(ot,r),{state:p}=await d.getFullState();if(p&&p.isDeployed){let s=await d.methods.getNftCustomData({answerId:0}).call({responsible:!0,cachedState:p});if(s.owner.equals(t)&&s.collection.equals(i.address)){const{address:i}=await e.getStateInit(ot,{workchain:0,tvc:n,initParams:{_id:s.id}});i.equals(r)&&o("Provider/setUserNft",{userAddress:t,nft:{address:r,id:s.id,owner:s.owner,lockedAmount:s.lockedAmount,description:s.description,url:s.url,x:parseInt(s.tilePixelsStartX),y:parseInt(s.tilePixelsStartY),width:parseInt(s.tilePixelsEndX)-parseInt(s.tilePixelsStartX),height:parseInt(s.tilePixelsEndY)-parseInt(s.tilePixelsStartY)}})}}}catch(l){console.log(l)}}}const wt={namespaced:!0,state:{venomConnect:null,provider:null,standaloneProvider:null,account:null,accountBalanceSubscriber:null,venomBalance:"0",userNftsLoadingStarted:!1,userNfts:[],collectionContract:null,collectionCachedState:null,collectionLoaded:!1,nftTvc:void 0,epoch:0,currentTilePrice:0,mintEnabled:!0,tilesByIndex:{},nftDataById:{}},mutations:{setVenomConnect(t,e){t.venomConnect=e},setStandaloneProvider(t,e){t.standaloneProvider=e,ft(e,this.commit)},setProvider(t,e){console.log("setProvider",e),t.provider=e,t.provider.subscribe("networkChanged").then((t=>{t.on("data",(t=>{e?.getProviderState().then((t=>{t?.permissions?.basic&&t?.permissions?.accountInteraction&&this.commit("Provider/setConnectedAccount",t?.permissions?.accountInteraction.address)}))}))}))},setCollection(t,{collectionContract:e,collectionCachedState:n,tilesByIndex:i,nftTvc:s}){console.log("setCollection"),t.collectionContract=e,t.collectionCachedState=n,t.tilesByIndex=i,t.nftTvc=s,t.collectionLoaded=!0,!t.userNftsLoadingStarted&&t.account&&(t.userNftsLoadingStarted=!0,vt(t.account,t.standaloneProvider,t.nftTvc,t.collectionContract,t.collectionCachedState,this.commit)),t.account&&yt(t.account,t.provider,this.commit)},setTile(t,{tile:e}){-1===ht.indexOf(e.nftId)&&(t.tilesByIndex[e.index]=e,delete t.nftDataById[e.nftId])},nftMinted(t,{owner:e,id:n}){t.account&&t.account.equals(e)&&gt(n,t.nftTvc,e,t.provider,this.commit)},setConnectedAccount(t,e){console.log("setConnectedAccount"),t.account=e,t.venomBalance="0",t.userNfts=[],t.accountBalanceSubscriber&&clearInterval(t.accountBalanceSubscriber),e&&yt(e,t.provider,this.commit),e&&(t.accountBalanceSubscriber=setInterval((()=>{yt(e,t.provider,this.commit)}),15e3)),e&&t.collectionCachedState?(t.userNftsLoadingStarted=!0,vt(e,t.standaloneProvider,t.collectionContract,t.collectionCachedState,this.commit)):t.userNftsLoadingStarted=!1},setAccountBalance(t,{address:e,balance:n}){t.account.toString()===e.toString()&&(t.venomBalance=n)},setNftDataLoadingInProgress(t,e){let n=t.nftDataById;n[e]||(n[e]={loading:!0,url:"",description:""},t.nftDataById=n)},setUserNft(t,{userAddress:e,nft:n}){if(t.account&&t.account.equals(e)&&!t.userNfts.find((t=>t.id===n.id))){let e=t.userNfts.slice();e.push(n),t.userNfts=e}},removeUserNft(t,e){t.userNfts=t.userNfts.filter((t=>t.id!==e))},setMintDisabled(t,e){t.mintDisabled=e},setEpoch(t,{epoch:e,price:n}){t.currentTilePrice=n,t.epoch=e},setNftData(t,{id:e,description:n,url:i}){let s=Object.assign({},t.nftDataById);s[e]={description:n.slice(0,2e3),url:i.slice(0,2e3)},t.nftDataById=s}},getters:{getNftDescriptionById:t=>e=>{let n=t.nftDataById,i=n[e];return i?i.description:""}},actions:{init({state:t,commit:e}){if(t.venomConnect)return;const n=new et.VenomConnect({theme:"light",checkNetworkId:1e3,providersOptions:{venomwallet:{links:{},walletWaysToConnect:[{package:nt.ProviderRpcClient,packageOptions:{fallback:et.VenomConnect.getPromise("venomwallet","extension")||(()=>Promise.reject()),forceUseFallback:!0},packageOptionsStandalone:{fallback:mt,forceUseFallback:!0},id:"extension",type:"extension"}],defaultWalletWaysToConnect:["mobile","ios","android"]}}});e("setVenomConnect",n),n.checkAuth().then((async t=>{await(t?.ensureInitialized());const i=await(t?.getProviderState());let s=await n.getStandalone();e("setStandaloneProvider",s),i?.permissions?.basic&&i?.permissions?.accountInteraction&&(console.log("We connected"),e("setProvider",t),e("setConnectedAccount",i?.permissions?.accountInteraction?.address))})),n.on("extension-auth",(async function(t){const n=await(t?.getProviderState());e("setProvider",t),n?.permissions?.accountInteraction?.address&&e("setConnectedAccount",n?.permissions?.accountInteraction?.address)}))},connect({state:t,commit:e}){t.venomConnect.connect()},disconnect({state:t,commit:e}){t.provider.disconnect(),e("setConnectedAccount",null)},claimTiles({state:t,commit:e},{x:n,y:i,width:s,height:o,tiles:a,description:r,url:l}){if(null===t.account)return void t.venomConnect.connect();let c=new t.provider.Contract(st,rt);const d=c.methods.claimTiles({pixelStartX:n,pixelStartY:i,pixelEndX:n+s,pixelEndY:i+o,tilesToColorify:a,description:r||"",url:l||"",coinsToRedrawOneTile:Math.floor(1e9*lt).toString()}).send({from:t.account,amount:Math.floor(s*o/100*parseInt(t.currentTilePrice)+1e9*(s*o/100*lt+ct+dt+pt)).toString()}).then((n=>new Promise((async(i,s)=>{let o=!1,a=[];const r=new t.provider.Subscriber;await r.trace(n).tap((t=>{t.account.equals(rt)&&a.push(t)})).finished();for(let n of a){let i=await t.collectionContract.decodeTransactionEvents({transaction:n});for(let n of i)"NftMinted"===n.event&&(o=!0,gt(n.data.nftId,t.nftTvc,n.data.owner,t.provider,e))}o?i():s(new Error("Nft not minted :-(. Price changed or space occupied."))}))));return d},redrawNft({state:t,commit:e},{id:n,x:i,y:s,width:o,height:a,tiles:r,description:l,url:c}){let d=new t.provider.Contract(st,rt);return d.methods.nftAddress({answerId:0,id:n}).call({responsible:!0,cachedState:t.collectionCachedState}).then((function(e){const n=new t.provider.Contract(ot,e.nft);return n.methods.colorify({tilesToColorify:r,description:l||"",url:c||"",sendGasBack:t.account,coinsToRedrawOneTile:(1e9*lt).toString()}).send({from:t.account,amount:(Math.floor(o*a/100*lt*1e9)+1e9).toString()}).then((function(e){return new Promise((async(n,i)=>{const s=new t.provider.Subscriber;await s.trace(e).tap((t=>{})).finished(),n()}))}))}))},burnNft({state:t,commit:e},n){return t.provider.getStateInit(ot,{workchain:0,tvc:t.nftTvc,initParams:{_id:n}}).then((function(i){let s=new t.provider.Contract(ot,i.address);return s.methods.burnNft({}).send({from:t.account,amount:(1e9*ut).toString()}).then((function(t){e("removeUserNft",n)}))}))},fetchNftData({state:t,commit:e},{id:n}){-1===ht.indexOf(n)&&!t.nftDataById[n]&&t.standaloneProvider&&t.collectionCachedState&&(e("setNftDataLoadingInProgress",n),t.standaloneProvider.getStateInit(ot,{workchain:0,tvc:t.nftTvc,initParams:{_id:n}}).then((function(e){let n=new t.standaloneProvider.Contract(ot,e.address);return n.methods.getNftCustomData({answerId:0}).call({responsible:!0})})).then((t=>{e("setNftData",{id:n,description:t.description,url:t.url})})))}}};i.ZP.use(tt.ZP);var xt=new tt.ZP.Store({state:{},mutations:{},actions:{},modules:{Provider:wt}}),bt=n(2468),Ct=n.n(bt);i.ZP.use(Ct()),i.ZP.config.productionTip=!1,new i.ZP({store:xt,render:t=>t(Q)}).$mount("#app")},6601:function(){}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=t,function(){var t=[];n.O=function(e,i,s,o){if(!i){var a=1/0;for(d=0;d<t.length;d++){i=t[d][0],s=t[d][1],o=t[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&o||a>=o)&&Object.keys(n.O).every((function(t){return n.O[t](i[l])}))?i.splice(l--,1):(r=!1,o<a&&(a=o));if(r){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,s,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.hmd=function(t){return t=Object.create(t),t.children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t}}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){n.p="/"}(),function(){n.b=document.baseURI||self.location.href;var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,i){var s,o,a=i[0],r=i[1],l=i[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(s in r)n.o(r,s)&&(n.m[s]=r[s]);if(l)var d=l(n)}for(e&&e(i);c<a.length;c++)o=a[c],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(d)},i=self["webpackChunksegmint_frontend"]=self["webpackChunksegmint_frontend"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(1974)}));i=n.O(i)})();
//# sourceMappingURL=app.447fc4d2.js.map